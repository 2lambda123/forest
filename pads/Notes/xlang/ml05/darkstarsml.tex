\begin{code}
type timestamp = Ptimestamp_explicit_FW(10, "%S", GMT)
\mbox{}
type 'a pnvp(f:Pstring -> bool) =
      \{ name : \{name : Pstring("=") | f name\}; 
        '='; 
        val : 'a \}
type 'a nvp(name:string) = 'a pnvp(fn s = (s = name))
type nvp_a = Pstring(";|") pnvp(fn s = true)
\mbox{}
type details = \{
      source      : Pip nvp("src_addr");
';';  dest        : Pip nvp("dest_addr");
';';  start_time  : timestamp nvp("start_time");
';';  end_time    : timestamp nvp("end_time");
';';  cycle_time  : Puint32 nvp("cycle_time")
\}
\mbox{}
datatype info(alarm_code : Puint32) =
  case alarm_code of 
    5074 => Details of details
  | _    => Generic of nvp_a Parray(';', '|')
\mbox{}
datatype service = DOMESTIC | INTERNATIONAL | SPECIAL
\mbox{}
type raw_alarm = \{
       alarm    : \{ alarm : Puint32 | alarm == 2 orelse alarm == 3\};
 ':';  start    : timestamp Popt;
 '|';  clear    : timestamp Popt;
 '|';  code     : Puint32;
 '|';  src_dns  : Pstring(";|") nvp("dns1");
 ';';  dest_dns : Pstring(";|") nvp("dns2");
 '|';  info     : info(code);
 '|';  service  : service;
\}
\mbox{}
fun checkCorr(ra:raw_alarm):bool =
  case ra of 
    \{alarm=2; start=SOME(_); clear=NONE;...\} => true
  | \{alarm=3; start=NONE;    clear=SOME(_);...\} => true
  |  _ => false
\mbox{}
type alarm = \{x:raw_alarm | checkCorr x\}
\mbox{}
type source = alarm Parray(Peor, Peof)
\end{code}
