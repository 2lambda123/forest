% sirius-filter.tex
% extracted from sirius-filter.c
% Sun Feb 27 23:20:23 2005
% 
\begin{centercode}
P\_t                  *p;
summary\_header\_t     header;
summary\_header\_t\_pd  header\_pd;
summary\_header\_t\_m   header\_m;
entry\_t              entry;
entry\_t\_pd           pd;
entry\_t\_m            mask;
\mbox{}
P\_open(&p, 0, 0);
P\_io\_fopen(p, "data/sirius");
\mbox{}
/* Initialize header data structures */
summary\_header\_t\_init(p,   &header);
summary\_header\_t\_pd\_init(p,&header\_pd);
summary\_header\_t\_m\_init(p, &header\_m, P\_CheckAndSet);
\mbox{}
/* Initialize entry data structures */
entry\_t\_init(p,    &entry);
entry\_t\_pd\_init(p, &pd);
entry\_t\_m\_init(p,  &mask, P\_CheckAndSet);
mask.events.compoundLevel = P\_Set;
\mbox{}
/* Try to read header   */
\kw{if} (P\_OK == summary\_header\_t\_read(p, &header\_m, &header\_pd, &header)) \{
  summary\_header\_t\_write2io(p, CLEAN\_FILE, &header\_pd, &header);
\} \kw{else} \{
  error(2, "reading header returned: error");
\}
\mbox{}
/* Try to read each line of data  */
\kw{while} (!P\_io\_at\_eof(p)) \{
  entry\_t\_read(p, &mask, &pd, &entry);
  \kw{if} (pd.nerr > 0) \{
    entry\_t\_write2io(p, ERR\_FILE, &pd, &entry);
  \} \kw{else} \{
    cnvPhoneNumbers(&entry);
    \kw{if} (entry\_t\_verify(&entry)) \{
      entry\_t\_write2io(p, CLEAN\_FILE, &pd, &entry);
    \} \kw{else} \{
      error(2, "Data transform failed.");
    \}
  \}
\}
P\_io\_close(p);
P\_close(p);
\end{centercode}
