% regulus.tex
% extracted from regulus.p
% Tue Apr  4 18:42:02 2006
% 
\begin{code}
/* Pstring terminated by a semicolon or vertical bar */
\kw{Ptypedef} Pstring\_SE(:"/;|\\\\|/":) SVString;
\mbox{}
\kw{Pstruct} Nvp\_string(:\kw{char} * s:)\{
  s; "="; SVString val;
\};
\mbox{}
\kw{Pstruct} Nvp\_ip(:\kw{char} * s:)\{
  s; "="; Pip val;
\};
\mbox{}
\kw{Pstruct} Nvp\_timestamp(:\kw{char} * s:)\{
  s; "="; Ptstamp val;
\};
\mbox{}
\kw{Pstruct} Nvp\_Puint32(:\kw{char} * s:)\{
  s; "="; Puint32 val;
\};
\mbox{}
\kw{Pstruct} Nvp\_a\{
      Pstring(:'=':) name;
 '='; SVString       val;
\};
\mbox{}
\kw{Pstruct} Details\{
      Nvp\_ip(:"src\_addr":) source;
';';  Nvp\_ip(:"dst\_addr":) dest;
';';  Nvp\_timestamp(:"start\_time":) start\_time;
';';  Nvp\_timestamp(:"end\_time":)   end\_time;
';';  Nvp\_Puint32(:"cycle\_time":)   cycle\_time;
\};
\mbox{}
\kw{Parray} Nvp\_seq\{
  Nvp\_a [] : \kw{Psep}(';') && \kw{Pterm}('|');
\};
\mbox{}
\kw{Punion} Info(:\kw{int} alarm\_code:)\{
  \kw{Pswitch} (alarm\_code)\{
    \kw{Pcase} 5074: Details   details;
    \kw{Pdefault}:   Nvp\_seq   generic;
  \}
\};
\mbox{}
\kw{Penum} Service \{
   DOMESTIC,
   INTERNATIONAL,
   SPECIAL
\};
\mbox{}
\kw{Pstruct} Raw\_alarm \{
       Puint32 alarm : alarm == 2 || alarm == 3;
 ':';  \kw{Popt} Ptstamp start;
 '|';  \kw{Popt} Ptstamp clear;
 '|';  Puint32      code;
 '|';  Nvp\_string(:"dns1":) src\_dns;
 ';';  Nvp\_string(:"dns2":) dest\_dns;
 '|';  Info(:code:) info;
 '|';  Service      service;
\};
\mbox{}
\kw{int} chkCorr(Raw\_alarm ra) \{ ...\};
\mbox{}
\kw{Precord} \kw{Ptypedef} Raw\_alarm Alarm :
         Alarm a => \{chkCorr(a)\};
\mbox{}
\kw{Psource} \kw{Parray} Source \{
  Alarm[];
\};
\end{code}
