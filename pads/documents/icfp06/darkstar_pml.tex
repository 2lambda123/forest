\kw{let} gmt = Pads.timezone\_of\_string "GMT"
\mbox{}
\kw{ptype} Timestamp = Ptimestamp\_explicit\_FW(8, "%H:%M:%S", gmt)
\kw{ptype} Pip = Puint8 * '.' * Puint8 * '.' * Puint8 * '.' * Puint8
\mbox{}
(* Generic name value pair. Accepts predicate over name as argument. *)
\kw{ptype} (Alpha) Pnvp(p : string -> bool) =
      \{ name : [name : Pstring('=') | p name]; 
        '='; 
        value : Alpha \}
\mbox{}
(* Name value pair with name specified. *)
\kw{ptype} (Alpha) Nvp(name:string) = Alpha Pnvp(fun s -> s = name)
\mbox{}
(* Pstring terminated by semicolon or vertical bar. *)
\kw{ptype} SVString = Pstring\_SE("/;|\cdbackslash\cdbackslash|/")
\mbox{}
(* Name value pair with any name. *)
\kw{ptype} Nvp\_a = SVString Pnvp(fun \_ -> true)
\mbox{}
\kw{ptype} Details = \{
      source      : Pip Nvp("src\_addr");
';';  dest        : Pip Nvp("dest\_addr");
';';  start\_time  : Timestamp Nvp("start\_time");
';';  end\_time    : Timestamp Nvp("end\_time");
';';  cycle\_time  : Puint32 Nvp("cycle\_time")
\}
\mbox{}
\kw{ptype} Semicolon = Pcharlit(';')
\kw{ptype} Vbar = Pcharlit('|')
\mbox{}
\kw{pdatatype} Info(alarm\_code : int) =
  Pmatch alarm\_code with
    5074 -> Details of Details
  | \_    -> Generic of (Nvp\_a,Semicolon,Vbar) Plist
\mbox{}
\kw{pdatatype} Service = 
    DOMESTIC      of omit "DOMESTIC" 
  | INTERNATIONAL of omit "INTERNATIONAL" 
  | SPECIAL       of omit "SPECIAL"
\mbox{}
\kw{ptype} Raw\_alarm = \{
       alarm     : [ alarm : Puint32 | alarm = 2 or alarm = 3];
 ':';  start     : Timestamp Popt;
 '|';  clear     : Timestamp Popt;
 '|';  code      : Puint32;
 '|';  src\_dns  : SVString Nvp("dns1");
 ';';  dest\_dns : SVString Nvp("dns2");
 '|';  info      : Info(code);
 '|';  service   : Service
\}
\mbox{}
let checkCorr ra = ...
\mbox{}
\kw{ptype} Alarm = [x:Raw\_alarm | checkCorr x]
\mbox{}
\kw{ptype} Source = (Alarm,Peor,Peof) Plist
