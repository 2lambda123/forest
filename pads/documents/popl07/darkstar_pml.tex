\begin{code}
(* Pstring terminated by semicolon or vertical bar. *)
 1. \kw{ptype} SVString = Pstring\_SE("/;|\\\\|/")
\mbox{}
(* Generic name value pair. Accepts predicate 
   over name as argument.  *)
 2. \kw{ptype} (Alpha) Pnvp(p : string -> bool) =
 3.       \{ name : [name : Pstring('=') | p name]; 
 4.         '='; 
 5.         value : Alpha \}
\mbox{}
(* Name value pair with name specified. *)
 6. \kw{ptype} (Alpha) Nvp(name:string) = 
 7.    Alpha Pnvp(fun s -> s = name)
\mbox{}
(* Name value pair with any name. *)
 8. \kw{ptype} Nvp\_a = SVString Pnvp(fun \_ -> true)
\mbox{}
 9. \kw{ptype} Details = \{
10.       source      : Pip Nvp("src\_addr");
11. ';';  dest        : Pip Nvp("dest\_addr");
12. ';';  start\_time  : Ptimestamp Nvp("start\_time");
13. ';';  end\_time    : Ptimestamp Nvp("end\_time");
14. ';';  cycle\_time  : Puint32 Nvp("cycle\_time")
15. \}

16. \kw{pdatatype} Info(alarm\_code : int) =
17.   match alarm\_code with
18.        5074 -> Details of Details
19.   | \_    -> Generic of Nvp\_a Plist(';','|')

20. \kw{pdatatype} Service = 
21.     DOMESTIC      of omit "DOMESTIC" 
22.   | INTERNATIONAL of omit "INTERNATIONAL" 
23.   | SPECIAL       of omit "SPECIAL"

24. \kw{ptype} Raw\_alarm = \{
25.        alarm     : [ i : Puint32 | i = 2 or i = 3];
26.  ':';  start     : Ptimestamp Popt;
27.  '|';  clear     : Ptimestamp Popt;
28.  '|';  code      : Puint32;
29.  '|';  src\_dns   : SVString Nvp("dns1");
30.  ';';  dest\_dns  : SVString Nvp("dns2");
31.  '|';  info      : Info(code);
32.  '|';  service   : Service
33. \} 

34. \kw{let} checkCorr ra = ...
35. \kw{ptype} Alarm = [x:Raw\_alarm | checkCorr x]

36. \kw{ptype} Source = Alarm Plist('\\n',\kw{peof})\end{code}
